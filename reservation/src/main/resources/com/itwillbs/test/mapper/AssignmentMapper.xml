<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.itwillbs.test.mapper.AssignmentMapper">
	
	<!-- 양도게시판 리스트 조회하기 시작 -->
	<select id="getAssignmentList" resultMap="AssignmentResultMap">
	    SELECT a.a_idx, a.a_status, a.a_price, a.a_sellerId, r.r_date, res.res_name, r.r_idx, a_sellerId, res.res_photo
	   		FROM assignment a
	    		JOIN reservation r ON a.r_idx = r.r_idx
	    		JOIN restaurant res ON res.res_idx = r.res_idx
	    			 WHERE a.a_status != 2 -- 양도상태가 '2-거래완료'가 아닌것만 조회
	    			 AND r.r_date >= CURDATE() -- 예약일자가 오늘 이후인 경우만 조회, 이전 날짜는 조회 안되게 함
  	</select>
	<resultMap id="AssignmentResultMap" type="com.itwillbs.test.vo.AssignmentVO">
	    <id property="a_idx" column="a_idx"/>
	    <result property="a_status" column="a_status"/>
	    <result property="a_price" column="a_price"/>
	    <result property="a_sellerId" column="a_sellerId"/>
	    <result property="r_idx" column="r_idx"/>
	    <result property="r_date" column="r_date"/>
	    <result property="res_name" column="res_name"/>
	    <result property="res_photo" column="res_photo"/>
	</resultMap>
	<!-- 양도게시판 리스트 조회하기 끝 -->

	<!-- 양도 테이블의 양도상태 컬럼을 '2-거래완료'로 변경하기 -->
	<update id="updateStatus" parameterType="int">
		  UPDATE assignment
		  	SET a_status = 2
		  		WHERE r_idx = #{r_idx}
	</update>
	<!-- 양도 테이블의 양도상태 컬럼을 '2-거래완료'로 변경하기 -->
		

</mapper>
