<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.itwillbs.test.mapper.AssignmentMapper">
	
	<!-- 양도 게시판 출력 리스트 -->
	<select id="getAssignmentList" resultType="java.util.Map">
	  SELECT *
	    FROM assignment a
		    JOIN reservation res ON a.r_idx = res.r_idx
		    JOIN restaurant r ON res.res_idx = r.res_idx
		    JOIN members m ON a.a_sellerId = m.m_id
			    WHERE a.a_status != 2 -- 양도상태가 '2-거래완료'가 아닌 것만 조회
			      AND res.r_date >= CURDATE() -- 예약일자가 오늘 이후인 경우만 조회, 이전 날짜는 조회하지 않음
	</select>


	<!-- 양도상태'2-거래완료'로 변경 -->
	<update id="updateStatus" parameterType="int">
		  UPDATE assignment
		  	SET a_status = 2
		  		WHERE r_idx = #{r_idx}
	</update>

</mapper>
